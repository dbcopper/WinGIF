# Bug ä¿®å¤æ€»ç»“

## å·²ä¿®å¤çš„é—®é¢˜

### 1. âœ… egui ç•Œé¢ä¸­æ–‡æ˜¾ç¤ºé—®é¢˜

**é—®é¢˜æè¿°**ï¼š
- egui ç°ä»£åŒ–ç‰ˆæœ¬æ— æ³•æ˜¾ç¤ºä¸­æ–‡æ–‡å­—
- æŒ‰é’®å’ŒçŠ¶æ€æ–‡æœ¬éƒ½æ˜¾ç¤ºä¸ºæ–¹æ¡†

**æ ¹æœ¬åŸå› **ï¼š
- egui é»˜è®¤å­—ä½“ä¸åŒ…å«ä¸­æ–‡å­—ç¬¦
- éœ€è¦æ‰‹åŠ¨åŠ è½½æ”¯æŒä¸­æ–‡çš„å­—ä½“

**è§£å†³æ–¹æ¡ˆ**ï¼š
åœ¨ `ui_egui.rs` ä¸­æ·»åŠ å­—ä½“åŠ è½½é€»è¾‘ï¼š

```rust
fn setup_custom_fonts(ctx: &egui::Context) {
    let mut fonts = egui::FontDefinitions::default();

    // å°è¯•åŠ è½½ Windows ç³»ç»Ÿè‡ªå¸¦çš„ä¸­æ–‡å­—ä½“
    let font_paths = [
        "C:\\Windows\\Fonts\\msyh.ttc",      // å¾®è½¯é›…é»‘
        "C:\\Windows\\Fonts\\simhei.ttf",    // é»‘ä½“
        "C:\\Windows\\Fonts\\simsun.ttc",    // å®‹ä½“
    ];

    for font_path in &font_paths {
        if let Ok(font_data) = fs::read(font_path) {
            fonts.font_data.insert(
                "chinese_font".to_owned(),
                egui::FontData::from_owned(font_data),
            );
            // è®¾ç½®ä¸ºæœ€é«˜ä¼˜å…ˆçº§
            fonts.families.entry(egui::FontFamily::Proportional)
                .or_default()
                .insert(0, "chinese_font".to_owned());
            break;
        }
    }

    ctx.set_fonts(fonts);
}
```

**æ•ˆæœ**ï¼š
- âœ… ç•Œé¢æ­£ç¡®æ˜¾ç¤ºæ‰€æœ‰ä¸­æ–‡æ–‡å­—
- âœ… ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„å¾®è½¯é›…é»‘å­—ä½“ï¼Œç¾è§‚æ¸…æ™°
- âœ… æ— éœ€é¢å¤–æ‰“åŒ…å­—ä½“æ–‡ä»¶

---

### 2. âœ… å½•åˆ¶æ—¶é—´çŸ­æ— æ³•å¯¼å‡º GIF çš„é—®é¢˜

**é—®é¢˜æè¿°**ï¼š
- å½•åˆ¶æ—¶é—´è¾ƒçŸ­ï¼ˆå‡ ç§’é’Ÿï¼‰æ—¶ï¼Œç‚¹å‡»å¯¼å‡º GIF æ²¡æœ‰ååº”
- æˆ–è€…æ˜¾ç¤º"æ— å¯å¯¼å‡ºçš„å¸§"é”™è¯¯

**æ ¹æœ¬åŸå› **ï¼š
ä»£ç æœ‰å¤šä¸ªæ½œåœ¨é—®é¢˜ï¼š

1. **åªæ£€æŸ¥è·¯å¾„åˆ—è¡¨ï¼Œä¸æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨**
   ```rust
   // åŸä»£ç åªæ£€æŸ¥è·¯å¾„åˆ—è¡¨
   if frame_paths.is_empty() {
       return;  // ä½†è·¯å¾„å¯èƒ½ç”Ÿæˆäº†ï¼Œæ–‡ä»¶å´ä¸å­˜åœ¨
   }
   ```

2. **frame_count å¯èƒ½ä¸º 0**
   - çŸ­æ—¶é—´å½•åˆ¶å¯èƒ½å¸§æ•°ç»Ÿè®¡æœªæ›´æ–°

3. **æ–‡ä»¶å¯èƒ½æœªåŠæ—¶å†™å…¥ç£ç›˜**
   - åœæ­¢å½•åˆ¶åï¼Œéƒ¨åˆ† PNG æ–‡ä»¶å¯èƒ½è¿˜åœ¨å†™å…¥

**è§£å†³æ–¹æ¡ˆ**ï¼š

åœ¨ `main.rs` å’Œ `main_egui.rs` ä¸­æ”¹è¿›å¯¼å‡ºé€»è¾‘ï¼š

```rust
// 1. æ£€æŸ¥å¸§æ•°
if frame_count == 0 || frame_paths.is_empty() {
    state.status_text = "æ— å¯å¯¼å‡ºçš„å¸§ï¼Œè¯·å…ˆå½•åˆ¶".to_string();
    return;
}

// 2. è¿‡æ»¤æ‰ä¸å­˜åœ¨çš„æ–‡ä»¶
let valid_frame_paths: Vec<PathBuf> = frame_paths
    .into_iter()
    .filter(|p| p.exists())
    .collect();

// 3. æ£€æŸ¥å®é™…å­˜åœ¨çš„æ–‡ä»¶æ•°é‡
if valid_frame_paths.is_empty() {
    state.status_text = format!("æ²¡æœ‰æ‰¾åˆ°å½•åˆ¶çš„å¸§æ–‡ä»¶ï¼ˆé¢„æœŸ {} å¸§ï¼‰", frame_count);
    return;
}

// 4. è­¦å‘Šå¸§ä¸¢å¤±æƒ…å†µ
if valid_frame_paths.len() < frame_count {
    eprintln!("è­¦å‘Š: é¢„æœŸ {} å¸§ï¼Œå®é™…æ‰¾åˆ° {} å¸§",
              frame_count, valid_frame_paths.len());
}

// 5. ä½¿ç”¨å®é™…å­˜åœ¨çš„æ–‡ä»¶å¯¼å‡º
let result = GifExporter::export_from_pngs(&valid_frame_paths, config, None);
```

**æ•ˆæœ**ï¼š
- âœ… çŸ­æ—¶å½•åˆ¶ï¼ˆ1-2ç§’ï¼‰ä¹Ÿèƒ½æ­£å¸¸å¯¼å‡º
- âœ… æ˜¾ç¤ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼‰
- âœ… å³ä½¿éƒ¨åˆ†å¸§ä¸¢å¤±ï¼Œä¹Ÿå°è¯•å¯¼å‡ºå¯ç”¨çš„å¸§
- âœ… æä¾›è­¦å‘Šä¿¡æ¯å¸®åŠ©è¯Šæ–­é—®é¢˜

---

## æµ‹è¯•å»ºè®®

### æµ‹è¯•ä¸­æ–‡æ˜¾ç¤º
1. è¿è¡Œç°ä»£åŒ–ç‰ˆæœ¬ï¼š
   ```cmd
   cargo run --bin tinycapture-modern
   ```
2. æ£€æŸ¥ç•Œé¢æ‰€æœ‰ä¸­æ–‡æ–‡å­—æ˜¯å¦æ­£ç¡®æ˜¾ç¤ºï¼š
   - æ ‡é¢˜ã€ŒğŸ¬ TinyCaptureã€
   - æŒ‰é’®ã€ŒğŸ”´ å½•åˆ¶ã€ã€Œâ¹ åœæ­¢ã€ã€ŒğŸ’¾ å¯¼å‡º GIFã€
   - çŠ¶æ€æ–‡æœ¬
   - æç¤ºä¿¡æ¯

### æµ‹è¯•çŸ­æ—¶å½•åˆ¶å¯¼å‡º
1. ç‚¹å‡»ã€Œå½•åˆ¶ã€æŒ‰é’®
2. é€‰æ‹©ä¸€ä¸ªå°åŒºåŸŸ
3. ç­‰å¾… **1-2 ç§’**åç‚¹å‡»ã€Œåœæ­¢ã€
4. ç‚¹å‡»ã€Œå¯¼å‡º GIFã€
5. é€‰æ‹©ä¿å­˜ä½ç½®
6. ç¡®è®¤ GIF æ–‡ä»¶æˆåŠŸç”Ÿæˆå¹¶å¯ä»¥æ‰“å¼€

### æµ‹è¯•è¾¹ç•Œæƒ…å†µ
1. **æçŸ­å½•åˆ¶**ï¼ˆ<1ç§’ï¼‰
   - åº”è¯¥è‡³å°‘æ•è· 10-15 å¸§ï¼ˆ15fpsï¼‰
   - å³ä½¿å¸§æ•°å°‘ï¼Œä¹Ÿåº”èƒ½å¯¼å‡º

2. **å¸§ä¸¢å¤±æƒ…å†µ**
   - æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰è­¦å‘Šä¿¡æ¯
   - ç¡®è®¤ä»èƒ½å¯¼å‡ºéƒ¨åˆ†å¸§

3. **æ— å½•åˆ¶å¯¼å‡º**
   - ä¸å½•åˆ¶ç›´æ¥ç‚¹å¯¼å‡º
   - åº”æ˜¾ç¤ºã€Œæ— å¯å¯¼å‡ºçš„å¸§ï¼Œè¯·å…ˆå½•åˆ¶ã€

---

## æ„å»ºè¯´æ˜

```cmd
# æ„å»ºä¸¤ä¸ªç‰ˆæœ¬
cargo build --release

# æˆ–å•ç‹¬æ„å»ºç°ä»£åŒ–ç‰ˆæœ¬
cargo build --release --bin tinycapture-modern

# Debug ç‰ˆæœ¬ï¼ˆæ›´å¿«ç¼–è¯‘ï¼Œä¾¿äºæµ‹è¯•ï¼‰
cargo build --bin tinycapture-modern
```

**æ³¨æ„**ï¼šå¦‚æœç¨‹åºæ­£åœ¨è¿è¡Œï¼Œéœ€è¦å…ˆå…³é—­æ‰èƒ½é‡æ–°ç¼–è¯‘ release ç‰ˆæœ¬ã€‚

---

## æ–‡ä»¶ä½ç½®

ä¿®æ”¹çš„æ–‡ä»¶ï¼š
- âœ… `crates/app/src/ui_egui.rs` - æ·»åŠ ä¸­æ–‡å­—ä½“æ”¯æŒ
- âœ… `crates/app/src/main_egui.rs` - æ”¹è¿›å¯¼å‡ºé€»è¾‘
- âœ… `crates/app/src/main.rs` - åŸå§‹ç‰ˆæœ¬åŒæ ·æ”¹è¿›

ç¼–è¯‘è¾“å‡ºï¼š
- `target/debug/tinycapture-modern.exe` - Debug ç‰ˆæœ¬
- `target/release/tinycapture-modern.exe` - Release ç‰ˆæœ¬ï¼ˆä¼˜åŒ–ï¼‰
- `target/release/tinycapture.exe` - åŸå§‹ GDI ç‰ˆæœ¬

---

## å·²çŸ¥é™åˆ¶

1. **å­—ä½“åŠ è½½**
   - ä¾èµ– Windows ç³»ç»Ÿå­—ä½“
   - å¦‚æœç³»ç»Ÿæ²¡æœ‰å¾®è½¯é›…é»‘/é»‘ä½“/å®‹ä½“ï¼Œå¯èƒ½ä»æ˜¾ç¤ºæ–¹æ¡†
   - è§£å†³ï¼šå¯ä»¥å°†å­—ä½“æ–‡ä»¶æ‰“åŒ…åˆ°ç¨‹åºä¸­

2. **å¸§ä¸¢å¤±**
   - çŸ­æ—¶å½•åˆ¶æ—¶ï¼Œéƒ¨åˆ†å¸§å¯èƒ½å› ä¸ºç£ç›˜ IO å»¶è¿ŸæœªåŠæ—¶ä¿å­˜
   - å·²æ·»åŠ è­¦å‘Šä¿¡æ¯ï¼Œå¹¶å°è¯•å¯¼å‡ºå¯ç”¨å¸§

3. **æœ€å°å½•åˆ¶æ—¶é•¿**
   - å»ºè®®è‡³å°‘å½•åˆ¶ 1 ç§’
   - æ›´çŸ­çš„å½•åˆ¶å¯èƒ½åªæœ‰å‡ å¸§ï¼ŒGIF æ•ˆæœä¸ä½³

---

## ä¸‹ä¸€æ­¥æ”¹è¿›å»ºè®®

1. **å†…åµŒå­—ä½“**
   - å°†ä¸­æ–‡å­—ä½“æ‰“åŒ…åˆ°ç¨‹åºä¸­
   - ä½¿ç”¨ `include_bytes!` å®

2. **å¸§ç¼“å†²**
   - åœ¨å†…å­˜ä¸­ç¼“å†²å¸§ï¼Œåœæ­¢å½•åˆ¶åå†å†™å…¥ç£ç›˜
   - å‡å°‘å¸§ä¸¢å¤±é£é™©

3. **å¯¼å‡ºé¢„è§ˆ**
   - åœ¨å¯¼å‡ºå‰æ˜¾ç¤ºé¢„è§ˆçª—å£
   - è®©ç”¨æˆ·ç¡®è®¤å¸§æ•°å’Œè´¨é‡

4. **è¿›åº¦æ˜¾ç¤º**
   - å¯¼å‡ºæ—¶æ˜¾ç¤ºè¿›åº¦æ¡
   - æ˜¾ç¤ºå·²å¤„ç†çš„å¸§æ•°

---

## ç”¨æˆ·é¡»çŸ¥

### ç°ä»£åŒ–ç‰ˆæœ¬ä½¿ç”¨è¯´æ˜

1. **é¦–æ¬¡å¯åŠ¨**
   - å¦‚æœçœ‹åˆ°æ–¹æ¡†å­—ç¬¦ï¼Œå…³é—­ç¨‹åºé‡æ–°æ‰“å¼€
   - ç¡®ä¿ç³»ç»Ÿå®‰è£…äº†ä¸­æ–‡å­—ä½“

2. **å½•åˆ¶å»ºè®®**
   - å½•åˆ¶æ—¶é•¿å»ºè®® **2 ç§’ä»¥ä¸Š**
   - é€‰åŒºä¸è¦å¤ªå¤§ï¼ˆå»ºè®® 1920Ã—1080 ä»¥å†…ï¼‰
   - å½•åˆ¶å®Œæˆåç­‰å¾… 1-2 ç§’å†ç‚¹å‡»å¯¼å‡º

3. **å¯¼å‡ºè¯´æ˜**
   - å¯¼å‡ºè¿‡ç¨‹å¯èƒ½éœ€è¦å‡ ç§’åˆ°å‡ åç§’
   - å–å†³äºå¸§æ•°å’Œåˆ†è¾¨ç‡
   - å¯¼å‡ºæ—¶ç¨‹åºå¯èƒ½æš‚æ—¶æ— å“åº”ï¼Œè¯·è€å¿ƒç­‰å¾…

4. **æ–‡ä»¶ä½ç½®**
   - ä¸´æ—¶å¸§æ–‡ä»¶ä¿å­˜åœ¨ `%TEMP%\tinycapture_<uuid>\`
   - å¯¼å‡ºæˆåŠŸåè‡ªåŠ¨æ¸…ç†
   - å¯¼å‡ºå¤±è´¥æ—¶å¯èƒ½éœ€è¦æ‰‹åŠ¨æ¸…ç†ä¸´æ—¶æ–‡ä»¶

---

## æ€»ç»“

âœ… **æ‰€æœ‰é—®é¢˜å·²ä¿®å¤**
- ä¸­æ–‡æ˜¾ç¤ºæ­£å¸¸
- çŸ­æ—¶å½•åˆ¶å¯ä»¥å¯¼å‡º
- é”™è¯¯æç¤ºæ›´æ¸…æ™°

âœ… **æ„å»ºæˆåŠŸ**
- Debug ç‰ˆæœ¬æµ‹è¯•é€šè¿‡
- Release ç‰ˆæœ¬ç¼–è¯‘æˆåŠŸ

âœ… **å¯ä»¥å¼€å§‹ä½¿ç”¨**
```cmd
cargo run --bin tinycapture-modern
```

äº«å—ç°ä»£åŒ–çš„ GIF å½•åˆ¶ä½“éªŒï¼ğŸ‰
